<mat-card>
  <mat-card-header>
    <mat-card-title>
      <mat-icon>notifications</mat-icon>
      Gestión de Notificaciones
    </mat-card-title>
    <div class="header-actions">
      <button mat-raised-button color="primary" (click)="crearNotificacion()">
        <mat-icon>add</mat-icon>
        Nueva Notificación
      </button>
    </div>
  </mat-card-header>

  <mat-card-content>
    <!-- Filtros -->
    <div class="filters-section">
      <mat-form-field appearance="outline">
        <mat-label>Funcionario</mat-label>
        <mat-icon matPrefix>person</mat-icon>
        <input matInput [(ngModel)]="filters.funcionario" (input)="onFilterChange()" placeholder="Buscar por funcionario">
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Expediente</mat-label>
        <mat-icon matPrefix>folder</mat-icon>
        <input matInput [(ngModel)]="filters.expediente" (input)="onFilterChange()" placeholder="Buscar por código de expediente">
      </mat-form-field>

      <button mat-button (click)="clearFilters()" class="clear-filters-btn">
        <mat-icon>clear</mat-icon>
        Limpiar Filtros
      </button>
    </div>

    <!-- Tabla -->
    <div class="table-container">
      <mat-progress-spinner 
        *ngIf="isLoading" 
        mode="indeterminate" 
        diameter="40">
      </mat-progress-spinner>

      <table mat-table [dataSource]="notificaciones" *ngIf="!isLoading" class="notificaciones-table">
        <!-- Emisión Column -->
        <ng-container matColumnDef="Emision">
          <th mat-header-cell *matHeaderCellDef>Fecha Emisión</th>
          <td mat-cell *matCellDef="let notificacion">
            {{ notificacion.Emision ? (notificacion.Emision | date:'dd/MM/yyyy') : '-' }}
          </td>
        </ng-container>

        <!-- Plazo Column -->
        <ng-container matColumnDef="Plazo">
          <th mat-header-cell *matHeaderCellDef>Plazo (días)</th>
          <td mat-cell *matCellDef="let notificacion">
            {{ notificacion.Plazo !== null && notificacion.Plazo !== undefined ? notificacion.Plazo : '-' }}
          </td>
        </ng-container>

        <!-- Código Expediente Column -->
        <ng-container matColumnDef="CodExp">
          <th mat-header-cell *matHeaderCellDef>Expediente</th>
          <td mat-cell *matCellDef="let notificacion">{{ notificacion.CodExp || '-' }}</td>
        </ng-container>

        <!-- Titular Column -->
        <ng-container matColumnDef="Titular">
          <th mat-header-cell *matHeaderCellDef>Titular</th>
          <td mat-cell *matCellDef="let notificacion">{{ notificacion.Titular || '-' }}</td>
        </ng-container>

        <!-- Funcionario Column -->
        <ng-container matColumnDef="Funcionario">
          <th mat-header-cell *matHeaderCellDef>Funcionario</th>
          <td mat-cell *matCellDef="let notificacion">{{ notificacion.Funcionario || '-' }}</td>
        </ng-container>

        <!-- Acciones Column -->
        <ng-container matColumnDef="acciones">
          <th mat-header-cell *matHeaderCellDef>Acciones</th>
          <td mat-cell *matCellDef="let notificacion" (click)="$event.stopPropagation()">
            <button mat-icon-button color="accent" (click)="verDetalle(notificacion)" matTooltip="Ver detalle">
              <mat-icon>visibility</mat-icon>
            </button>
            <button mat-icon-button color="primary" (click)="editarNotificacion(notificacion)" matTooltip="Editar">
              <mat-icon>edit</mat-icon>
            </button>
            <button mat-icon-button color="warn" (click)="eliminarNotificacion(notificacion.IdNotificacion)" matTooltip="Eliminar">
              <mat-icon>delete</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="['Emision', 'Plazo', 'CodExp', 'Titular', 'Funcionario', 'acciones']"></tr>
        <tr mat-row *matRowDef="let row; columns: ['Emision', 'Plazo', 'CodExp', 'Titular', 'Funcionario', 'acciones'];" 
            class="clickable-row" 
            (click)="verDetalle(row)" 
            matTooltip=""></tr>
      </table>

      <!-- Mensaje cuando no hay datos -->
      <div *ngIf="!isLoading && notificaciones.length === 0" class="no-data-message">
        <mat-icon>info</mat-icon>
        <p>No se encontraron notificaciones</p>
      </div>
    </div>

    <!-- Paginador -->
    <mat-paginator
      #paginator
      [length]="totalRecords"
      [pageSize]="pageSize"
      [pageSizeOptions]="pageSizeOptions"
      [pageIndex]="currentPage"
      (page)="onPageChange($event)"
      showFirstLastButtons
      class="paginator">
    </mat-paginator>
  </mat-card-content>
</mat-card>